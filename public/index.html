<!--
  Only the changed/added parts are shown here. Merge with your previous index.html for a complete file.
-->
<!-- ...admin panel, above forms... -->
<form id="adminActionsForm" class="d-flex gap-2 mb-3">
  <button type="button" class="btn btn-outline-warning" id="undoBtn"><i class="bi bi-arrow-counterclockwise"></i> Undo</button>
  <button type="button" class="btn btn-outline-info" id="redoBtn"><i class="bi bi-arrow-clockwise"></i> Redo</button>
</form>

<!-- ...stats section... -->
<div class="stats-section mx-auto" style="max-width: 1050px;">
  <h3 class="mb-3">Tournament Overview</h3>
  <div class="row mb-3 g-3">
    <div class="col-md-6">
      <h5 class="text-primary mb-2">Upcoming Matches</h5>
      <div id="upcomingMatchesList" class="row g-2"></div>
    </div>
    <div class="col-md-6">
      <h5 class="text-success mb-2">Recent Results</h5>
      <div id="recentResultsList" class="row g-2"></div>
    </div>
  </div>
  <div class="row mb-3 g-3">
    <div class="col-md-6">
      <h5 class="text-warning mb-2">Points Table</h5>
      <table class="table table-striped table-hover shadow" id="pointsTable">
        <thead class="table-dark">
          <tr>
            <th>Team</th><th>Played</th><th>Won</th><th>Lost</th><th>Points</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="col-md-6">
      <div class="row g-2">
        <div class="col-12">
          <h5 class="text-info mb-2">Top 5 Batters</h5>
          <div id="topBattersList" class="row g-2"></div>
        </div>
        <div class="col-12 mt-3">
          <h5 class="text-info mb-2">Top 5 Bowlers</h5>
          <div id="topBowlersList" class="row g-2"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-12">
      <h5 class="text-secondary mb-2">Teams & Players</h5>
      <div class="accordion" id="teamsAccordion"></div>
    </div>
  </div>
</div>

<script>
  document.getElementById('undoBtn').onclick = async () => {
    await fetch('/api/admin-undo', { method: 'POST' }).then(r => r.json()).then(data => {
      if (data.success) {
        showToast('Undo successful!', 'warning');
        loadStats();
      } else showToast(data.error, 'danger');
    });
  };
  document.getElementById('redoBtn').onclick = async () => {
    await fetch('/api/admin-redo', { method: 'POST' }).then(r => r.json()).then(data => {
      if (data.success) {
        showToast('Redo successful!', 'info');
        loadStats();
      } else showToast(data.error, 'danger');
    });
  };

  // Remove match (admin-only, shown on each match card)
  document.addEventListener('click', async function(e) {
    if (e.target.classList.contains('remove-match-btn')) {
      const matchId = e.target.dataset.matchId;
      // Save match object for undo
      const resStat = await fetch('/api/stats');
      const dataStat = await resStat.json();
      const matchObj = dataStat.matches.find(m => m.matchId === matchId);
      await fetch('/api/removeMatch', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ matchId, matchObj })
      }).then(res => res.json()).then(data => {
        if (data.success) {
          showToast('Match removed!', 'danger');
          loadStats();
        } else showToast(data.error || 'Error', 'danger');
      });
    }
  });

  async function loadStats() {
    const res = await fetch('/api/stats');
    const data = await res.json();

    // Upcoming matches - as cards
    document.getElementById('upcomingMatchesList').innerHTML = data.upcomingMatches.length
      ? data.upcomingMatches.map(m => `
        <div class="col-12">
          <div class="card shadow border-primary border-2 mb-2">
            <div class="card-body">
              <h5 class="card-title"><span class="badge bg-primary">${m.matchId}</span> <b>${m.teamA}</b> vs <b>${m.teamB}</b></h5>
              <p class="card-text">
                <i class="bi bi-calendar-event"></i> ${m.matchDateTime ? new Date(m.matchDateTime).toLocaleString() : 'Not set'}
              </p>
              ${document.getElementById('adminPanel') && !document.getElementById('adminPanel').classList.contains('d-none')
                ? `<button class="btn btn-sm btn-outline-danger remove-match-btn" data-match-id="${m.matchId}"><i class="bi bi-x-circle"></i> Remove</button>`
                : ''}
            </div>
          </div>
        </div>
      `).join('')
      : '<div class="col-12"><div class="text-muted">No upcoming matches</div></div>';

    // Recent results - as cards
    document.getElementById('recentResultsList').innerHTML = data.finishedMatches.length
      ? data.finishedMatches.map(m => `
        <div class="col-12">
          <div class="card shadow border-success border-2 mb-2">
            <div class="card-body">
              <h5 class="card-title"><span class="badge bg-success">${m.matchId}</span> <b>${m.teamA}</b> vs <b>${m.teamB}</b></h5>
              <p class="card-text"><i class="bi bi-trophy"></i> Winner: <span class="fw-bold text-success">${m.winner}</span></p>
              <p class="card-text"><i class="bi bi-calendar"></i> ${m.matchDateTime ? new Date(m.matchDateTime).toLocaleDateString() : ''}</p>
              ${document.getElementById('adminPanel') && !document.getElementById('adminPanel').classList.contains('d-none')
                ? `<button class="btn btn-sm btn-outline-danger remove-match-btn" data-match-id="${m.matchId}"><i class="bi bi-x-circle"></i> Remove</button>`
                : ''}
            </div>
          </div>
        </div>
      `).join('')
      : '<div class="col-12"><div class="text-muted">No recent results</div></div>';

    // Top Batters - as cards with progress bars
    document.getElementById('topBattersList').innerHTML = data.topBatters.length
      ? data.topBatters.map(b => `
        <div class="col-12">
          <div class="card border-info shadow-sm">
            <div class="card-body py-2">
              <div class="d-flex align-items-center">
                <i class="bi bi-person-circle text-info" style="font-size:1.6em;"></i>
                <div class="ms-3 w-100">
                  <span class="fw-bold">${b.playerName}</span> <span class="badge bg-info">${b.team}</span>
                  <div class="progress mt-1" style="height: 8px;">
                    <div class="progress-bar bg-primary" style="width:${b.runs / (data.topBatters[0].runs || 1) * 100}%"></div>
                  </div>
                  <small>Runs: <span class="fw-bold text-primary">${b.runs}</span></small>
                </div>
              </div>
            </div>
          </div>
        </div>
      `).join('')
      : '<div class="col-12"><div class="text-muted">No data</div></div>';

    // Top Bowlers - as cards with progress bars
    document.getElementById('topBowlersList').innerHTML = data.topBowlers.length
      ? data.topBowlers.map(b => `
        <div class="col-12">
          <div class="card border-success shadow-sm">
            <div class="card-body py-2">
              <div class="d-flex align-items-center">
                <i class="bi bi-person-fill text-success" style="font-size:1.6em;"></i>
                <div class="ms-3 w-100">
                  <span class="fw-bold">${b.playerName}</span> <span class="badge bg-success">${b.team}</span>
                  <div class="progress mt-1" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width:${b.wickets / (data.topBowlers[0].wickets || 1) * 100}%"></div>
                  </div>
                  <small>Wickets: <span class="fw-bold text-success">${b.wickets}</span></small>
                </div>
              </div>
            </div>
          </div>
        </div>
      `).join('')
      : '<div class="col-12"><div class="text-muted">No data</div></div>';

    // Points table
    const ptbody = document.querySelector('#pointsTable tbody');
    ptbody.innerHTML = data.pointsTable.length
      ? data.pointsTable.map(row =>
        `<tr>
          <td><span class="fw-bold">${row.team}</span></td>
          <td>${row.played}</td>
          <td class="text-success fw-bold">${row.won}</td>
          <td class="text-danger fw-bold">${row.lost}</td>
          <td class="fw-bold">${row.points}</td>
        </tr>`).join('')
      : '<tr><td colspan="5" class="text-muted text-center">No data</td></tr>';

    // Teams & Players - as before, or use cards for players if you wish
    let teamsHtml = '';
    let idx = 0;
    for (let [team, players] of Object.entries(data.teams)) {
      teamsHtml += `
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading${idx}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${idx}" aria-expanded="false" aria-controls="collapse${idx}">
              ${team}
            </button>
          </h2>
          <div id="collapse${idx}" class="accordion-collapse collapse" aria-labelledby="heading${idx}" data-bs-parent="#teamsAccordion">
            <div class="accordion-body">
              <ul class="stats-list ps-3 mb-0">
      `;
      players.forEach(p => {
        teamsHtml += `<li><span class="highlight">${p.playerName}</span> â€“ Runs: <span class="text-primary">${p.runs}</span>, Wickets: <span class="text-success">${p.wickets}</span></li>`;
      });
      teamsHtml += `</ul></div></div></div>`;
      idx++;
    }
    document.getElementById('teamsAccordion').innerHTML = teamsHtml;
  }
  // ... (rest of your JS unchanged) ...
</script>